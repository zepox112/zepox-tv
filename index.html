<!DOCTYPE html>
<html lang="sw">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zepox TV | TV Edition</title>

    <link rel="icon" type="image/jpeg" href="logo.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />

    <style>
        body {
            background-color: #020617;
            color: white;
            height: 100vh;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        /* Menu inavyokaa */
        #sidebar {
            transition: transform 0.3s ease;
            z-index: 100;
        }

        /* Focus style kwa ajili ya Remote ya TV */
        .channel-item:focus {
            background-color: #2563eb !important;
            border: 3px solid white !important;
            outline: none;
            transform: scale(1.02);
        }

        .channel-list {
            height: calc(100vh - 180px);
            overflow-y: auto;
            scroll-behavior: smooth;
            /* Inafanya scrolling iwe laini */
        }

        .video-js {
            width: 100% !important;
            height: 100% !important;
            background-color: #000;
        }

        .zepox-watermark {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 50;
            font-size: 14px;
            font-weight: 900;
            color: white;
            background: rgba(37, 99, 235, 0.6);
            padding: 5px 12px;
            border-radius: 6px;
        }

        .active-channel {
            background: #1e40af !important;
            border-left: 5px solid #60a5fa;
        }
    </style>
</head>

<body class="flex flex-col">

    <header class="p-4 bg-slate-900 border-b border-slate-800 flex justify-between items-center shadow-2xl">
        <div class="flex items-center gap-4">
            <button id="menuBtn" onclick="toggleMenu()" class="bg-blue-600 p-2 rounded-lg focus:ring-4 ring-white">
                <span class="font-bold text-sm">CHANNELS</span>
            </button>
            <h1 class="text-xl font-black italic text-blue-500 uppercase">ZEPOX <span class="text-white">TV</span></h1>
        </div>
        <div id="clock" class="text-sm font-mono text-blue-400 font-bold">00:00:00 EAT</div>
    </header>

    <main class="flex flex-1 overflow-hidden relative">
        <aside id="sidebar"
            class="w-80 bg-slate-950 border-r border-slate-800 flex flex-col p-4 absolute md:relative h-full">
            <input type="text" id="search" onkeyup="searchChannels()"
                class="w-full bg-slate-900 p-3 rounded-xl text-sm outline-none border border-slate-800 focus:border-blue-600 mb-4"
                placeholder="Tafuta channel...">

            <div id="channel-container" class="channel-list space-y-2">
            </div>
        </aside>

        <section class="flex-1 bg-black relative">
            <div class="zepox-watermark">ZEPOX TV</div>
            <video id="my-video" class="video-js vjs-big-play-centered" controls preload="auto" playsinline></video>
        </section>
    </main>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script>
        const player = videojs('my-video');
        const ZEPOX_URL = "https://a0504dae9c72cdb02b00ddedf6df4973.livehwc4.com/pullsgp.yyzb456.top/live/stream-698168_lhd.m3u8?sub_m3u8=true&edge_slice=true&user_session_id=8c55b0e9e2ac74d562bc04f0d4394478";
        let allChannels = [{ name: "⭐ ZEPOX TV OFFICIAL 1", url: ZEPOX_URL }];

        // --- REMOTE CONTROL OPTIMIZATION ---
        window.addEventListener('keydown', function (e) {
            const list = document.getElementById('channel-container');
            if (e.key === "PageDown") {
                list.scrollTop += 500; // Scroll kwa kasi zaidi chini
            } else if (e.key === "PageUp") {
                list.scrollTop -= 500; // Scroll kwa kasi zaidi juu
            }
        });

        function toggleMenu() {
            const sb = document.getElementById('sidebar');
            sb.style.display = (sb.style.display === 'none') ? 'flex' : 'none';
        }

        async function init() {
            renderChannels(allChannels);
            playChannel(ZEPOX_URL);

            try {
                const res = await fetch('https://iptv-org.github.io/iptv/index.m3u');
                const data = await res.text();
                parseM3U(data);
                renderChannels(allChannels);
            } catch (e) { console.log("List Error"); }
        }

        function parseM3U(data) {
            const lines = data.split('\n');
            let current = {};
            for (let line of lines) {
                if (line.startsWith('#EXTINF:')) current.name = line.split(',')[1].trim();
                else if (line.startsWith('http')) {
                    current.url = line.trim();
                    if (current.name && !allChannels.some(c => c.url === current.url)) {
                        allChannels.push({ ...current });
                    }
                    current = {};
                }
            }
        }

        function renderChannels(channels) {
            const container = document.getElementById('channel-container');
            // TBC na Zepox kwanza
            const sorted = [...channels].sort((a, b) => {
                if (a.name.includes("ZEPOX") || a.name.includes("TBC")) return -1;
                return 0;
            });

            container.innerHTML = sorted.map(ch => `
                <button onclick="playChannel('${ch.url}', this)" 
                     class="channel-item w-full p-4 bg-slate-900/50 hover:bg-slate-800 rounded-xl cursor-pointer truncate text-left text-sm flex items-center gap-3 transition-all border border-transparent">
                    <span class="text-blue-500">▶</span> ${ch.name}
                </button>
            `).join('');
        }

        function playChannel(url, element = null) {
            if (element) {
                document.querySelectorAll('.active-channel').forEach(el => el.classList.remove('active-channel'));
                element.classList.add('active-channel');
            }
            player.src({ src: url, type: 'application/x-mpegURL' });
            player.play().catch(() => {
                player.src({ src: "https://corsproxy.io/?" + encodeURIComponent(url), type: 'application/x-mpegURL' });
                player.play();
            });
        }

        function searchChannels() {
            const q = document.getElementById('search').value.toLowerCase();
            renderChannels(allChannels.filter(ch => ch.name.toLowerCase().includes(q)));
        }

        // Clock
        setInterval(() => {
            const options = { timeZone: 'Africa/Dar_es_Salaam', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', options) + " EAT";
        }, 1000);

        init();
    </script>
</body>

</html>